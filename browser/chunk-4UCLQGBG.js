var _=typeof WeakRef<"u",a=class{constructor(e,s=!1,t,r){this.initialize(e,s,t,r)}initialize(e,s=!1,t,r){return this.mask=e,this.skipNextObservers=s,this.target=t,this.currentTarget=r,this}},h=class{constructor(e,s,t=null){this.callback=e,this.mask=s,this.scope=t,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(e=!1){this._remove&&this._remove(e)}},u=class l{static FromPromise(e,s){let t=new l;return e.then(r=>{t.notifyObservers(r)}).catch(r=>{if(s)s.notifyObservers(r);else throw r}),t}get observers(){return this._observers}constructor(e,s=!1){this.notifyIfTriggered=s,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new a(0),e&&(this._onObserverAdded=e)}add(e,s=-1,t=!1,r=null,f=!1){if(!e)return null;let i=new h(e,s,r);i.unregisterOnNextCall=f,t?this._observers.unshift(i):this._observers.push(i),this._onObserverAdded&&this._onObserverAdded(i),this._hasNotified&&this.notifyIfTriggered&&this._lastNotifiedValue!==void 0&&this.notifyObserver(i,this._lastNotifiedValue);let n=_?new WeakRef(this):{deref:()=>this};return i._remove=(d=!1)=>{let o=n.deref();o&&(d?o.remove(i):o._remove(i))},i}addOnce(e){return this.add(e,void 0,void 0,void 0,!0)}remove(e){return e?(e._remove=null,this._observers.indexOf(e)!==-1?(this._deferUnregister(e),!0):!1):!1}removeCallback(e,s){for(let t=0;t<this._observers.length;t++){let r=this._observers[t];if(!r._willBeUnregistered&&r.callback===e&&(!s||s===r.scope))return this._deferUnregister(r),!0}return!1}_deferUnregister(e){e._willBeUnregistered||(this._numObserversMarkedAsDeleted++,e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout(()=>{this._remove(e)},0))}_remove(e,s=!0){if(!e)return!1;let t=this._observers.indexOf(e);return t!==-1?(s&&this._numObserversMarkedAsDeleted--,this._observers.splice(t,1),!0):!1}makeObserverTopPriority(e){this._remove(e,!1),this._observers.unshift(e)}makeObserverBottomPriority(e){this._remove(e,!1),this._observers.push(e)}notifyObservers(e,s=-1,t,r,f){if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=e),!this._observers.length)return!0;let i=this._eventState;i.mask=s,i.target=t,i.currentTarget=r,i.skipNextObservers=!1,i.lastReturnValue=e,i.userInfo=f;for(let n of this._observers)if(!n._willBeUnregistered&&(n.mask&s&&(n.unregisterOnNextCall&&this._deferUnregister(n),n.scope?i.lastReturnValue=n.callback.apply(n.scope,[e,i]):i.lastReturnValue=n.callback(e,i)),i.skipNextObservers))return!1;return!0}notifyObserver(e,s,t=-1){if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=s),e._willBeUnregistered)return;let r=this._eventState;r.mask=t,r.skipNextObservers=!1,e.unregisterOnNextCall&&this._deferUnregister(e),e.callback(s,r)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){let e=this._observers.pop();e&&(e._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){let e=new l;return e._observers=this._observers.slice(0),e}hasSpecificMask(e=-1){for(let s of this._observers)if(s.mask&e||s.mask===e)return!0;return!1}};export{a,u as b};
