import{a as C}from"./chunk-5SDLENZK.js";import{b as W}from"./chunk-3WG2WLZ4.js";import{J as V,a as z,j as G,k as P}from"./chunk-OQPKOFQF.js";import{a as $}from"./chunk-CWQQB2EJ.js";import{b as H}from"./chunk-65CEQG3Z.js";import{b as T}from"./chunk-4UCLQGBG.js";import{a as B}from"./chunk-PTJ4CXVK.js";import{a as M}from"./chunk-YMYK7FOB.js";var me=(()=>{class e{static Instantiate(t){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[t])return this.RegisteredExternalClasses[t];let c=W(t);if(c)return c;B.Warn(t+" not found, you may have missed an import.");let l=t.split("."),s=window||this;for(let f=0,i=l.length;f<i;f++)s=s[l[f]];return typeof s!="function"?null:s}}return e.RegisteredExternalClasses={},e})();var v=(()=>{class e{}return e.FilesToLoad={},e})();var D=class{static ExponentialBackoff(o=3,t=500){return(c,l,s)=>l.status!==0||s>=o||c.indexOf("file:")!==-1?-1:Math.pow(2,s)*t}};var y=class extends Error{};y._setPrototypeOf=Object.setPrototypeOf||((e,o)=>(e.__proto__=o,e));var I={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002},U=class e extends y{constructor(o,t,c){super(o),this.errorCode=t,this.innerError=c,this.name="RuntimeError",y._setPrototypeOf(this,e.prototype)}};var X=e=>{let o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t="",c,l,s,f,i,d,p,n=0,r=ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e);for(;n<r.length;)c=r[n++],l=n<r.length?r[n++]:Number.NaN,s=n<r.length?r[n++]:Number.NaN,f=c>>2,i=(c&3)<<4|l>>4,d=(l&15)<<2|s>>6,p=s&63,isNaN(l)?d=p=64:isNaN(s)&&(p=64),t+=o.charAt(f)+o.charAt(i)+o.charAt(d)+o.charAt(p);return t},N=e=>atob(e),J=e=>{let o=N(e),t=o.length,c=new Uint8Array(new ArrayBuffer(t));for(let l=0;l<t;l++)c[l]=o.charCodeAt(l);return c.buffer};var Q=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i),F=class e extends U{constructor(o,t){super(o,I.LoadFileError),this.name="LoadFileError",y._setPrototypeOf(this,e.prototype),t instanceof C?this.request=t:this.file=t}},j=class e extends U{constructor(o,t){super(o,I.RequestFileError),this.request=t,this.name="RequestFileError",y._setPrototypeOf(this,e.prototype)}},k=class e extends U{constructor(o,t){super(o,I.ReadFileError),this.file=t,this.name="ReadFileError",y._setPrototypeOf(this,e.prototype)}},ie=e=>(e=e.replace(/#/gm,"%23"),e),h={DefaultRetryStrategy:D.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:e=>e,ScriptBaseUrl:"",ScriptPreprocessUrl:e=>e,CleanUrl:ie},Y=(e,o)=>{if(!(e&&e.indexOf("data:")===0)&&h.CorsBehavior)if(typeof h.CorsBehavior=="string"||h.CorsBehavior instanceof String)o.crossOrigin=h.CorsBehavior;else{let t=h.CorsBehavior(e);t&&(o.crossOrigin=t)}},K={getRequiredSize:null},Z=(e,o,t,c,l="",s,f=H.LastCreatedEngine)=>{if(typeof HTMLImageElement>"u"&&!f?._features.forceBitmapOverHTMLImageElement)return t("LoadImage is only supported in web or BabylonNative environments."),null;let i,d=!1;e instanceof ArrayBuffer||ArrayBuffer.isView(e)?typeof Blob<"u"&&typeof URL<"u"?(i=URL.createObjectURL(new Blob([e],{type:l})),d=!0):i=`data:${l};base64,`+X(e):e instanceof Blob?(i=URL.createObjectURL(e),d=!0):(i=h.CleanUrl(e),i=h.PreprocessUrl(i));let p=a=>{if(t){let u=i||e.toString();t(`Error while trying to load image: ${u.indexOf("http")===0||u.length<=128?u:u.slice(0,128)+"..."}`,a)}};if(f?._features.forceBitmapOverHTMLImageElement)return O(i,a=>{f.createImageBitmap(new Blob([a],{type:l}),M({premultiplyAlpha:"none"},s)).then(u=>{o(u),d&&URL.revokeObjectURL(i)}).catch(u=>{t&&t("Error while trying to load image: "+e,u)})},void 0,c||void 0,!0,(a,u)=>{p(u)}),null;let n=new Image;if(K.getRequiredSize){let a=K.getRequiredSize(e);a.width&&(n.width=a.width),a.height&&(n.height=a.height)}Y(i,n);let r=[],g=()=>{for(let a of r)a.target.addEventListener(a.name,a.handler)},m=()=>{for(let a of r)a.target.removeEventListener(a.name,a.handler);r.length=0},E=()=>{m(),o(n),d&&n.src&&URL.revokeObjectURL(n.src)},x=a=>{m(),p(a),d&&n.src&&URL.revokeObjectURL(n.src)},S=a=>{if(a.blockedURI!==n.src||a.disposition==="report")return;m();let u=new Error(`CSP violation of policy ${a.effectiveDirective} ${a.blockedURI}. Current policy is ${a.originalPolicy}`);H.UseFallbackTexture=!1,p(u),d&&n.src&&URL.revokeObjectURL(n.src),n.src=""};r.push({target:n,name:"load",handler:E}),r.push({target:n,name:"error",handler:x}),r.push({target:document,name:"securitypolicyviolation",handler:S}),g();let R=i.substring(0,5)==="blob:",L=i.substring(0,5)==="data:",b=()=>{R||L||!C.IsCustomRequestAvailable?n.src=i:O(i,(a,u,A)=>{let oe=!l&&A?A:l,se=new Blob([a],{type:oe}),ae=URL.createObjectURL(se);d=!0,n.src=ae},void 0,c||void 0,!0,(a,u)=>{p(u)})},q=()=>{c&&c.loadImage(i,n)};if(!R&&!L&&c&&c.enableTexturesOffline)c.open(q,b);else{if(i.indexOf("file:")!==-1){let a=decodeURIComponent(i.substring(5).toLowerCase());if(v.FilesToLoad[a]&&typeof URL<"u"){try{let u;try{u=URL.createObjectURL(v.FilesToLoad[a])}catch{u=URL.createObjectURL(v.FilesToLoad[a])}n.src=u,d=!0}catch{n.src=""}return n}}b()}return n},_=(e,o,t,c,l)=>{let s=new FileReader,f={onCompleteObservable:new T,abort:()=>s.abort()};return s.onloadend=()=>f.onCompleteObservable.notifyObservers(f),l&&(s.onerror=()=>{l(new k(`Unable to read ${e.name}`,e))}),s.onload=i=>{o(i.target.result)},t&&(s.onprogress=t),c?s.readAsArrayBuffer(e):s.readAsText(e),f},O=(e,o,t,c,l,s,f)=>{if(e.name)return _(e,o,t,l,s?n=>{s(void 0,n)}:void 0);let i=e;if(i.indexOf("file:")!==-1){let n=decodeURIComponent(i.substring(5).toLowerCase());n.indexOf("./")===0&&(n=n.substring(2));let r=v.FilesToLoad[n];if(r)return _(r,o,t,l,s?g=>s(void 0,new F(g.message,g.file)):void 0)}let{match:d,type:p}=ce(i);if(d){let n={onCompleteObservable:new T,abort:()=>()=>{}};try{let r=l?re(i):ne(i);o(r,void 0,p)}catch(r){s?s(void 0,r):B.Error(r.message||"Failed to parse the Data URL")}return P.SetImmediate(()=>{n.onCompleteObservable.notifyObservers(n)}),n}return ee(i,(n,r)=>{o(n,r?.responseURL,r?.getResponseHeader("content-type"))},t,c,l,s?n=>{s(n.request,new F(n.message,n.request))}:void 0,f)},ee=(e,o,t,c,l,s,f)=>{e=h.CleanUrl(e),e=h.PreprocessUrl(e);let i=h.BaseUrl+e,d=!1,p={onCompleteObservable:new T,abort:()=>d=!0},n=()=>{let r=new C,g=null,m,E=()=>{r&&(t&&r.removeEventListener("progress",t),m&&r.removeEventListener("readystatechange",m),r.removeEventListener("loadend",x))},x=()=>{E(),p.onCompleteObservable.notifyObservers(p),p.onCompleteObservable.clear(),t=void 0,m=null,x=null,s=void 0,f=void 0,o=void 0};p.abort=()=>{d=!0,x&&x(),r&&r.readyState!==(XMLHttpRequest.DONE||4)&&r.abort(),g!==null&&(clearTimeout(g),g=null),r=null};let S=L=>{let b=L.message||"Unknown error";s&&r?s(new j(b,r)):B.Error(b)},R=L=>{if(r){if(r.open("GET",i),f)try{f(r)}catch(b){S(b);return}l&&(r.responseType="arraybuffer"),t&&r.addEventListener("progress",t),x&&r.addEventListener("loadend",x),m=()=>{if(!(d||!r)&&r.readyState===(XMLHttpRequest.DONE||4)){if(m&&r.removeEventListener("readystatechange",m),r.status>=200&&r.status<300||r.status===0&&(!$()||te())){let a=l?r.response:r.responseText;if(a!==null){try{o&&o(a,r)}catch(u){S(u)}return}}let b=h.DefaultRetryStrategy;if(b){let a=b(i,r,L);if(a!==-1){E(),r=new C,g=setTimeout(()=>R(L+1),a);return}}let q=new j("Error status: "+r.status+" "+r.statusText+" - Unable to load "+i,r);s&&s(q)}},r.addEventListener("readystatechange",m),r.send()}};R(0)};if(c&&c.enableSceneOffline){let r=m=>{m&&m.status>400?s&&s(m):n()},g=()=>{c&&c.loadFile(h.BaseUrl+e,m=>{!d&&o&&o(m),p.onCompleteObservable.notifyObservers(p)},t?m=>{!d&&t&&t(m)}:void 0,r,l)};c.open(g,r)}else n();return p};var te=()=>typeof location<"u"&&location.protocol==="file:",le=e=>Q.test(e),ce=e=>{let o=Q.exec(e);return o===null||o.length===0?{match:!1,type:""}:{match:!0,type:o[0].replace("data:","").replace("base64,","")}};function re(e){return J(e.split(",")[1])}var ne=e=>N(e.split(",")[1]),fe=()=>{V._FileToolsLoadImage=Z,z.loadFile=O,G.loadFile=O};fe();var w,de=(e,o,t,c,l,s,f,i,d,p)=>{w={DecodeBase64UrlToBinary:e,DecodeBase64UrlToString:o,DefaultRetryStrategy:t.DefaultRetryStrategy,BaseUrl:t.BaseUrl,CorsBehavior:t.CorsBehavior,PreprocessUrl:t.PreprocessUrl,IsBase64DataUrl:c,IsFileURL:l,LoadFile:s,LoadImage:f,ReadFile:i,RequestFile:d,SetCorsBehavior:p},Object.defineProperty(w,"DefaultRetryStrategy",{get:function(){return t.DefaultRetryStrategy},set:function(n){t.DefaultRetryStrategy=n}}),Object.defineProperty(w,"BaseUrl",{get:function(){return t.BaseUrl},set:function(n){t.BaseUrl=n}}),Object.defineProperty(w,"PreprocessUrl",{get:function(){return t.PreprocessUrl},set:function(n){t.PreprocessUrl=n}}),Object.defineProperty(w,"CorsBehavior",{get:function(){return t.CorsBehavior},set:function(n){t.CorsBehavior=n}})};de(re,ne,h,le,te,O,Z,_,ee,Y);export{I as a,U as b,X as c,J as d,me as e,h as f,Y as g,Z as h,_ as i,O as j,ee as k,le as l,re as m};
