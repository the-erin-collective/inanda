import{b as m}from"./chunk-TQC3L4XM.js";import{c as x,d as A}from"./chunk-WPV5ZQU6.js";import{f as v}from"./chunk-HFWKE5SR.js";import{b as l}from"./chunk-65CEQG3Z.js";import{g as w}from"./chunk-GON3DZPO.js";var c,d=null;function C(){return w(this,null,function*(){return d||(d=new Promise((t,s)=>{let n,e=null,o={preserveDrawingBuffer:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};import("./chunk-KFULZFSY.js").then(({ThinEngine:i})=>{let p=l.Instances.length;try{n=new OffscreenCanvas(100,100),e=new i(n,!1,o)}catch{p<l.Instances.length&&l.Instances.pop()?.dispose(),n=document.createElement("canvas"),e=new i(n,!1,o)}l.Instances.pop(),l.OnEnginesDisposedObservable.add(r=>{e&&r!==e&&!e.isDisposed&&l.Instances.length===0&&S()}),e.getCaps().parallelShaderCompile=void 0;let f=new x(e);import("./chunk-SLUH6TEB.js").then(({passPixelShader:r})=>{if(!e){s("Engine is not defined");return}let a=new A({engine:e,name:r.name,fragmentShader:r.shader,samplerNames:["textureSampler"]});c={canvas:n,engine:e,renderer:f,wrapper:a},t(c)})}).catch(s)})),yield d})}function E(t,s,n,e,o="image/png",i,p){return w(this,null,function*(){let f=yield n.readPixels(0,0,t,s),r=new Uint8Array(f.buffer);D(t,s,r,e,o,i,!0,void 0,p)})}function I(t,s,n,e="image/png",o,i=!1,p=!1,f){return w(this,null,function*(){return yield new Promise(r=>{D(t,s,n,a=>r(a),e,o,i,p,f)})})}function D(t,s,n,e,o="image/png",i,p=!1,f=!1,r){C().then(a=>{if(a.engine.setSize(t,s,!0),n instanceof Float32Array){let g=new Uint8Array(n.length),u=n.length;for(;u--;){let h=n[u];g[u]=Math.round(v(h)*255)}n=g}let y=a.engine.createRawTexture(n,t,s,5,!1,!p,1);a.renderer.setViewport(),a.renderer.applyEffectWrapper(a.wrapper),a.wrapper.effect._bindTexture("textureSampler",y),a.renderer.draw(),f?m.ToBlob(a.canvas,g=>{let u=new FileReader;u.onload=h=>{let b=h.target.result;e&&e(b)},u.readAsArrayBuffer(g)},o,r):m.EncodeScreenshotCanvasData(a.canvas,e,o,i,r),y.dispose()})}function S(){c?(c.wrapper.dispose(),c.renderer.dispose(),c.engine.dispose()):d?.then(t=>{t.wrapper.dispose(),t.renderer.dispose(),t.engine.dispose()}),d=null,c=null}var O={DumpData:D,DumpDataAsync:I,DumpFramebuffer:E,Dispose:S},R=()=>{m.DumpData=D,m.DumpDataAsync=I,m.DumpFramebuffer=E};R();export{E as a,I as b,D as c,S as d,O as e};
