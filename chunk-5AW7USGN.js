import{d as V,x as M,y as L}from"./chunk-CQXM36R5.js";import{h as S}from"./chunk-6M2KQJKK.js";import{a as Y}from"./chunk-XXSLHR3E.js";import{f as w}from"./chunk-PTNAZJQ7.js";import{C as Q,I as Z,J as D}from"./chunk-OQPKOFQF.js";import{a as I}from"./chunk-PTJ4CXVK.js";function q(o){let G=o.split("?")[0],t=G.lastIndexOf(".");return t>-1?G.substring(t).toLowerCase():""}D.prototype._partialLoadFile=function(o,G,t,r,s=null){let f=u=>{t[G]=u,t._internalCount++,t._internalCount===6&&r(t)},p=(u,e)=>{s&&u&&s(u.status+" "+u.statusText,e)};this._loadFile(o,f,void 0,void 0,!0,p)};D.prototype._cascadeLoadFiles=function(o,G,t,r=null){let s=[];s._internalCount=0;for(let f=0;f<6;f++)this._partialLoadFile(t[f],f,s,G,r)};D.prototype._cascadeLoadImgs=function(o,G,t,r,s=null,f){let p=[];p._internalCount=0;for(let u=0;u<6;u++)this._partialLoadImg(r[u],u,p,o,G,t,s,f)};D.prototype._partialLoadImg=function(o,G,t,r,s,f,p=null,u){let e=Y();S(o,n=>{t[G]=n,t._internalCount++,r&&r.removePendingData(e),t._internalCount===6&&f&&f(s,t)},(n,c)=>{r&&r.removePendingData(e),p&&p(n,c)},r?r.offlineProvider:null,u),r&&r.addPendingData(e)};D.prototype.createCubeTextureBase=function(o,G,t,r,s=null,f=null,p,u=null,e=!1,A=0,a=0,n=null,c=null,i=null,_=!1,y=null){let l=n||new Q(this,7);l.isCube=!0,l.url=o,l.generateMipMaps=!r,l._lodGenerationScale=A,l._lodGenerationOffset=a,l._useSRGBBuffer=!!_&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!r),l!==n&&(l.label=o.substring(0,60)),this._doNotHandleContextLost||(l._extension=u,l._files=t,l._buffer=y);let F=o;this._transformTextureUrl&&!n&&(o=this._transformTextureUrl(o));let d=u??q(o),B=Z(d),R=(C,h)=>{l.dispose(),f?f(C,h):C&&I.Warn(C)},P=(C,h)=>{o===F?C&&R(C.status+" "+C.statusText,h):(I.Warn(`Failed to load ${o}, falling back to the ${F}`),this.createCubeTextureBase(F,G,t,!!r,s,R,p,u,e,A,a,l,c,i,_,y))};if(B)B.then(C=>{let h=m=>{c&&c(l,m),C.loadCubeData(m,l,e,s,(U,T)=>{R(U,T)})};y?h(y):t&&t.length===6?C.supportCascades?this._cascadeLoadFiles(G,m=>h(m.map(U=>new Uint8Array(U))),t,R):R("Textures type does not support cascades."):this._loadFile(o,m=>h(new Uint8Array(m)),void 0,void 0,!0,P)});else{if(!t||t.length===0)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(G,l,(C,h)=>{i&&i(C,h)},t,R)}return this._internalTexturesCache.push(l),l};var dt=542327876,tt=131072,et=512,rt=4,at=64,nt=131072;function X(o){return o.charCodeAt(0)+(o.charCodeAt(1)<<8)+(o.charCodeAt(2)<<16)+(o.charCodeAt(3)<<24)}function Gt(o){return String.fromCharCode(o&255,o>>8&255,o>>16&255,o>>24&255)}var ot=X("DXT1"),st=X("DXT3"),ft=X("DXT5"),z=X("DX10"),it=113,lt=116,ct=2,ut=10,_t=88,$=31,ht=0,xt=1,At=2,pt=3,j=4,yt=7,v=20,mt=21,bt=22,Bt=23,Rt=24,Ot=25,Ut=26,wt=28,Lt=32,$t=(()=>{class o{static GetDDSInfo(t){let r=new Int32Array(t.buffer,t.byteOffset,$),s=new Int32Array(t.buffer,t.byteOffset,$+4),f=1;r[At]&tt&&(f=Math.max(1,r[yt]));let p=r[mt],u=p===z?s[Lt]:0,e=0;switch(p){case it:e=2;break;case lt:e=1;break;case z:if(u===ut){e=2;break}if(u===ct){e=1;break}}return{width:r[j],height:r[pt],mipmapCount:f,isFourCC:(r[v]&rt)===rt,isRGB:(r[v]&at)===at,isLuminance:(r[v]&nt)===nt,isCube:(r[wt]&et)===et,isCompressed:p===ot||p===st||p===ft,dxgiFormat:u,textureType:e}}static _GetHalfFloatAsFloatRGBAArrayBuffer(t,r,s,f,p,u){let e=new Float32Array(f),A=new Uint16Array(p,s),a=0;for(let n=0;n<r;n++)for(let c=0;c<t;c++){let i=(c+n*t)*4;e[a]=L(A[i]),e[a+1]=L(A[i+1]),e[a+2]=L(A[i+2]),o.StoreLODInAlphaChannel?e[a+3]=u:e[a+3]=L(A[i+3]),a+=4}return e}static _GetHalfFloatRGBAArrayBuffer(t,r,s,f,p,u){if(o.StoreLODInAlphaChannel){let e=new Uint16Array(f),A=new Uint16Array(p,s),a=0;for(let n=0;n<r;n++)for(let c=0;c<t;c++){let i=(c+n*t)*4;e[a]=A[i],e[a+1]=A[i+1],e[a+2]=A[i+2],e[a+3]=M(u),a+=4}return e}return new Uint16Array(p,s,f)}static _GetFloatRGBAArrayBuffer(t,r,s,f,p,u){if(o.StoreLODInAlphaChannel){let e=new Float32Array(f),A=new Float32Array(p,s),a=0;for(let n=0;n<r;n++)for(let c=0;c<t;c++){let i=(c+n*t)*4;e[a]=A[i],e[a+1]=A[i+1],e[a+2]=A[i+2],e[a+3]=u,a+=4}return e}return new Float32Array(p,s,f)}static _GetFloatAsHalfFloatRGBAArrayBuffer(t,r,s,f,p,u){let e=new Uint16Array(f),A=new Float32Array(p,s),a=0;for(let n=0;n<r;n++)for(let c=0;c<t;c++)e[a]=M(A[a]),e[a+1]=M(A[a+1]),e[a+2]=M(A[a+2]),o.StoreLODInAlphaChannel?e[a+3]=M(u):e[a+3]=M(A[a+3]),a+=4;return e}static _GetFloatAsUIntRGBAArrayBuffer(t,r,s,f,p,u){let e=new Uint8Array(f),A=new Float32Array(p,s),a=0;for(let n=0;n<r;n++)for(let c=0;c<t;c++){let i=(c+n*t)*4;e[a]=w(A[i])*255,e[a+1]=w(A[i+1])*255,e[a+2]=w(A[i+2])*255,o.StoreLODInAlphaChannel?e[a+3]=u:e[a+3]=w(A[i+3])*255,a+=4}return e}static _GetHalfFloatAsUIntRGBAArrayBuffer(t,r,s,f,p,u){let e=new Uint8Array(f),A=new Uint16Array(p,s),a=0;for(let n=0;n<r;n++)for(let c=0;c<t;c++){let i=(c+n*t)*4;e[a]=w(L(A[i]))*255,e[a+1]=w(L(A[i+1]))*255,e[a+2]=w(L(A[i+2]))*255,o.StoreLODInAlphaChannel?e[a+3]=u:e[a+3]=w(L(A[i+3]))*255,a+=4}return e}static _GetRGBAArrayBuffer(t,r,s,f,p,u,e,A,a){let n=new Uint8Array(f),c=new Uint8Array(p,s),i=0;for(let _=0;_<r;_++)for(let y=0;y<t;y++){let l=(y+_*t)*4;n[i]=c[l+u],n[i+1]=c[l+e],n[i+2]=c[l+A],n[i+3]=c[l+a],i+=4}return n}static _ExtractLongWordOrder(t){return t===0||t===255||t===-16777216?0:1+o._ExtractLongWordOrder(t>>8)}static _GetRGBArrayBuffer(t,r,s,f,p,u,e,A){let a=new Uint8Array(f),n=new Uint8Array(p,s),c=0;for(let i=0;i<r;i++)for(let _=0;_<t;_++){let y=(_+i*t)*3;a[c]=n[y+u],a[c+1]=n[y+e],a[c+2]=n[y+A],c+=3}return a}static _GetLuminanceArrayBuffer(t,r,s,f,p){let u=new Uint8Array(f),e=new Uint8Array(p,s),A=0;for(let a=0;a<r;a++)for(let n=0;n<t;n++){let c=n+a*t;u[A]=e[c],A++}return u}static UploadDDSLevels(t,r,s,f,p,u,e=-1,A,a=!0){let n=null;f.sphericalPolynomial&&(n=[]);let c=!!t.getCaps().s3tc;r.generateMipMaps=p;let i=new Int32Array(s.buffer,s.byteOffset,$),_,y,l,F=0,d,B,R,P,C=0,h=1;if(i[ht]!==dt){I.Error("Invalid magic number in DDS header");return}if(!f.isFourCC&&!f.isRGB&&!f.isLuminance){I.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");return}if(f.isCompressed&&!c){I.Error("Compressed textures are not supported on this platform.");return}let m=i[bt];d=i[xt]+4;let U=!1;if(f.isFourCC)switch(_=i[mt],_){case ot:h=8,C=33777;break;case st:h=16,C=33778;break;case ft:h=16,C=33779;break;case it:U=!0,m=64;break;case lt:U=!0,m=128;break;case z:{d+=5*4;let b=!1;switch(f.dxgiFormat){case ut:U=!0,m=64,b=!0;break;case ct:U=!0,m=128,b=!0;break;case _t:f.isRGB=!0,f.isFourCC=!1,m=32,b=!0;break}if(b)break}default:I.Error(["Unsupported FourCC code:",Gt(_)]);return}let T=o._ExtractLongWordOrder(i[Bt]),J=o._ExtractLongWordOrder(i[Rt]),K=o._ExtractLongWordOrder(i[Ot]),Ft=o._ExtractLongWordOrder(i[Ut]);U&&(C=t._getRGBABufferInternalSizedFormat(f.textureType)),R=1,i[At]&tt&&p!==!1&&(R=Math.max(1,i[yt]));let Ct=A||0,H=t.getCaps();for(let b=Ct;b<u;b++){for(y=i[j],l=i[pt],P=0;P<R;++P){if(e===-1||e===P){let x=e===-1?P:0;if(!f.isCompressed&&f.isFourCC){r.format=5,F=y*l*4;let O=null;if(t._badOS||t._badDesktopOS||!H.textureHalfFloat&&!H.textureFloat)m===128?(O=o._GetFloatAsUIntRGBAArrayBuffer(y,l,s.byteOffset+d,F,s.buffer,x),n&&x==0&&n.push(o._GetFloatRGBAArrayBuffer(y,l,s.byteOffset+d,F,s.buffer,x))):m===64&&(O=o._GetHalfFloatAsUIntRGBAArrayBuffer(y,l,s.byteOffset+d,F,s.buffer,x),n&&x==0&&n.push(o._GetHalfFloatAsFloatRGBAArrayBuffer(y,l,s.byteOffset+d,F,s.buffer,x))),r.type=0;else{let E=H.textureFloat&&(a&&H.textureFloatLinearFiltering||!a),W=H.textureHalfFloat&&(a&&H.textureHalfFloatLinearFiltering||!a),N=(m===128||m===64&&!W)&&E?1:(m===64||m===128&&!E)&&W?2:0,k,g=null;switch(m){case 128:{switch(N){case 1:k=o._GetFloatRGBAArrayBuffer,g=null;break;case 2:k=o._GetFloatAsHalfFloatRGBAArrayBuffer,g=o._GetFloatRGBAArrayBuffer;break;case 0:k=o._GetFloatAsUIntRGBAArrayBuffer,g=o._GetFloatRGBAArrayBuffer;break}break}default:{switch(N){case 1:k=o._GetHalfFloatAsFloatRGBAArrayBuffer,g=null;break;case 2:k=o._GetHalfFloatRGBAArrayBuffer,g=o._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:k=o._GetHalfFloatAsUIntRGBAArrayBuffer,g=o._GetHalfFloatAsFloatRGBAArrayBuffer;break}break}}r.type=N,O=k(y,l,s.byteOffset+d,F,s.buffer,x),n&&x==0&&n.push(g?g(y,l,s.byteOffset+d,F,s.buffer,x):O)}O&&t._uploadDataToTextureDirectly(r,O,b,x)}else if(f.isRGB)r.type=0,m===24?(r.format=4,F=y*l*3,B=o._GetRGBArrayBuffer(y,l,s.byteOffset+d,F,s.buffer,T,J,K),t._uploadDataToTextureDirectly(r,B,b,x)):(r.format=5,F=y*l*4,B=o._GetRGBAArrayBuffer(y,l,s.byteOffset+d,F,s.buffer,T,J,K,Ft),t._uploadDataToTextureDirectly(r,B,b,x));else if(f.isLuminance){let O=t._getUnpackAlignement(),E=y;F=Math.floor((y+O-1)/O)*O*(l-1)+E,B=o._GetLuminanceArrayBuffer(y,l,s.byteOffset+d,F,s.buffer),r.format=1,r.type=0,t._uploadDataToTextureDirectly(r,B,b,x)}else F=Math.max(4,y)/4*Math.max(4,l)/4*h,B=new Uint8Array(s.buffer,s.byteOffset+d,F),r.type=0,t._uploadCompressedDataToTextureDirectly(r,C,y,l,B,b,x)}d+=m?y*l*(m/8):F,y*=.5,l*=.5,y=Math.max(1,y),l=Math.max(1,l)}if(A!==void 0)break}n&&n.length>0?f.sphericalPolynomial=V.ConvertCubeMapToSphericalPolynomial({size:i[j],right:n[0],left:n[1],up:n[2],down:n[3],front:n[4],back:n[5],format:5,type:1,gammaSpace:!1}):f.sphericalPolynomial=void 0}}return o.StoreLODInAlphaChannel=!1,o})();export{$t as a};
