import{a as F}from"./chunk-SO644OCK.js";import{a as I}from"./chunk-PTJ4CXVK.js";function K(e,s,t,i){switch(s){case 5120:{let r=e.getInt8(t);return i&&(r=Math.max(r/127,-1)),r}case 5121:{let r=e.getUint8(t);return i&&(r=r/255),r}case 5122:{let r=e.getInt16(t,!0);return i&&(r=Math.max(r/32767,-1)),r}case 5123:{let r=e.getUint16(t,!0);return i&&(r=r/65535),r}case 5124:return e.getInt32(t,!0);case 5125:return e.getUint32(t,!0);case 5126:return e.getFloat32(t,!0);default:throw new Error(`Invalid component type ${s}`)}}function B(e,s,t,i,r){switch(s){case 5120:{i&&(r=Math.round(r*127)),e.setInt8(t,r);break}case 5121:{i&&(r=Math.round(r*255)),e.setUint8(t,r);break}case 5122:{i&&(r=Math.round(r*32767)),e.setInt16(t,r,!0);break}case 5123:{i&&(r=Math.round(r*65535)),e.setUint16(t,r,!0);break}case 5124:{e.setInt32(t,r,!0);break}case 5125:{e.setUint32(t,r,!0);break}case 5126:{e.setFloat32(t,r,!0);break}default:throw new Error(`Invalid component type ${s}`)}}function g(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${e}'`)}}function p(e){switch(e){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${e}'`)}}function D(e,s,t,i,r,f,l,h){let u=new Array(i),a=new Array(i);if(e instanceof Array){let n=s/4,_=t/4;for(let o=0;o<f;o+=i){for(let c=0;c<i;c++)u[c]=a[c]=e[n+c];h(a,o);for(let c=0;c<i;c++)u[c]!==a[c]&&(e[n+c]=a[c]);n+=_}}else{let n=ArrayBuffer.isView(e)?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(e),_=g(r);for(let o=0;o<f;o+=i){for(let c=0,d=s;c<i;c++,d+=_)u[c]=a[c]=K(n,r,d,l);h(a,o);for(let c=0,d=s;c<i;c++,d+=_)u[c]!==a[c]&&B(n,r,d,l,a[c]);s+=t}}}function T(e,s,t,i,r,f,l,h){let u=s*g(t),a=l*s;if(t!==5126||r!==u){let n=new Float32Array(a);return D(e,i,r,s,t,a,f,(_,o)=>{for(let c=0;c<s;c++)n[o+c]=_[c]}),n}if(!(e instanceof Array||e instanceof Float32Array)||i!==0||e.length!==a)if(e instanceof Array){let n=i/4;return e.slice(n,n+a)}else{if(e instanceof ArrayBuffer)return new Float32Array(e,i,a);{let n=e.byteOffset+i;return(n&3)!==0&&(I.Warn("Float array must be aligned to 4-bytes border"),h=!0),h?new Float32Array(e.buffer.slice(n,n+a*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(e.buffer,n,a)}}return h?e.slice():e}function M(e,s,t,i,r,f,l,h){let u=g(t),a=p(t),n=l*s;if(Array.isArray(e)){if((i&3)!==0||(r&3)!==0)throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");let b=i/4,E=r/4;if(b+(l-1)*E+s>e.length)throw new Error("Last accessed index is out of bounds.");if(E<s)throw new Error("Data stride cannot be smaller than the component size.");if(E!==s){let y=new a(n);return D(e,i,r,s,t,n,f,(U,m)=>{for(let w=0;w<s;w++)y[m+w]=U[w]}),y}return new a(e.slice(b,b+n))}let _,o=i;if(e instanceof ArrayBuffer?_=e:(_=e.buffer,o+=e.byteOffset),o+(l-1)*r+s*u>_.byteLength)throw new Error("Last accessed byte is out of bounds.");let d=s*u;if(r<d)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(r!==d){let b=new a(n);return D(_,o,r,s,t,n,f,(E,A)=>{for(let y=0;y<s;y++)b[A+y]=E[y]}),b}return u!==1&&(o&u-1)!==0&&(I.Warn("Array must be aligned to border of element size. Data will be copied."),h=!0),h?new a(_.slice(o,o+n*u)):new a(_,o,n)}function G(e,s,t,i,r,f,l,h){let u=s*g(t),a=l*s;if(h.length!==a)throw new Error("Output length is not valid");if(t!==5126||r!==u){D(e,i,r,s,t,a,f,(n,_)=>{for(let o=0;o<s;o++)h[_+o]=n[o]});return}if(e instanceof Array){let n=i/4;h.set(e,n)}else if(e instanceof ArrayBuffer){let n=new Float32Array(e,i,a);h.set(n)}else{let n=e.byteOffset+i;if((n&3)!==0){I.Warn("Float array must be aligned to 4-bytes border"),h.set(new Float32Array(e.buffer.slice(n,n+a*Float32Array.BYTES_PER_ELEMENT)));return}let _=new Float32Array(e.buffer,n,a);h.set(_)}}function P(e,s,t=0,i=0){if(Array.isArray(e)){for(let r=0;r<s;r++)if(e[t+r]-i>65535)return!0;return!1}return e.BYTES_PER_ELEMENT===4}var S=class{get isDisposed(){return this._isDisposed}constructor(s,t,i,r=0,f=!1,l=!1,h=!1,u,a){this._isAlreadyOwned=!1,this._isDisposed=!1,s&&s.getScene?this._engine=s.getScene().getEngine():this._engine=s,this._updatable=i,this._instanced=l,this._divisor=u||1,this._label=a,t instanceof F?(this._data=null,this._buffer=t):(this._data=t,this._buffer=null),this.byteStride=h?r:r*Float32Array.BYTES_PER_ELEMENT,f||this.create()}createVertexBuffer(s,t,i,r,f,l=!1,h){let u=l?t:t*Float32Array.BYTES_PER_ELEMENT,a=r?l?r:r*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new N(this._engine,this,s,this._updatable,!0,a,f===void 0?this._instanced:f,u,i,void 0,void 0,!0,this._divisor||h)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(s=null){!s&&this._buffer||(s=s||this._data,s&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,s),this._data=s):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(s,this._label),this._data=s):this._buffer=this._engine.createVertexBuffer(s,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.capacity>0){this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.capacity,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.capacity,void 0,this._label);return}I.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(s){this.create(s)}updateDirectly(s,t,i,r=!1){this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,s,r?t:t*Float32Array.BYTES_PER_ELEMENT,i?i*this.byteStride:void 0),t===0&&i===void 0?this._data=s:this._data=null)}_increaseReferences(){if(this._buffer){if(!this._isAlreadyOwned){this._isAlreadyOwned=!0;return}this._buffer.references++}}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}},N=(()=>{class e{get isDisposed(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(t){let i=t!=0;this._instanceDivisor=t,i!==this._instanced&&(this._instanced=i,this._computeHashCode())}get _maxVerticesCount(){let t=this.getData();return t?Array.isArray(t)?t.length/(this.byteStride/4)-this.byteOffset/4:(t.byteLength-this.byteOffset)/this.byteStride:0}constructor(t,i,r,f,l,h,u,a,n,_,o=!1,c=!1,d=1,b=!1){this._isDisposed=!1;let E=!1;if(this.engine=t,typeof f=="object"&&f!==null?(E=f.updatable??!1,l=f.postponeInternalCreation,h=f.stride,u=f.instanced,a=f.offset,n=f.size,_=f.type,o=f.normalized??!1,c=f.useBytes??!1,d=f.divisor??1,b=f.takeBufferOwnership??!1,this._label=f.label):E=!!f,i instanceof S?(this._buffer=i,this._ownsBuffer=b):(this._buffer=new S(t,i,E,h,l,u,c,d,this._label),this._ownsBuffer=!0),this.uniqueId=e._Counter++,this._kind=r,_===void 0){let y=this.getData();this.type=y?e.GetDataType(y):e.FLOAT}else this.type=_;let A=g(this.type);c?(this._size=n||(h?h/A:e.DeduceStride(r)),this.byteStride=h||this._buffer.byteStride||this._size*A,this.byteOffset=a||0):(this._size=n||h||e.DeduceStride(r),this.byteStride=h?h*A:this._buffer.byteStride||this._size*A,this.byteOffset=(a||0)*A),this.normalized=o,this._instanced=u!==void 0?u:!1,this._instanceDivisor=u?d:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){this._buffer?._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(t,i){let r=this.getData();return r?T(r,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,t,i):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/g(this.type)}getOffset(){return this.byteOffset/g(this.type)}getSize(t=!1){return t?this._size*g(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(t){this._buffer.create(t),this._alignBuffer()}update(t){this._buffer.update(t),this._alignBuffer()}updateDirectly(t,i,r=!1){this._buffer.updateDirectly(t,i,void 0,r),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(t,i){D(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,t,this.normalized,(r,f)=>{for(let l=0;l<this._size;l++)i(r[l],f+l)})}_alignBuffer(){}static DeduceStride(t){switch(t){case e.UVKind:case e.UV2Kind:case e.UV3Kind:case e.UV4Kind:case e.UV5Kind:case e.UV6Kind:return 2;case e.NormalKind:case e.PositionKind:return 3;case e.ColorKind:case e.ColorInstanceKind:case e.MatricesIndicesKind:case e.MatricesIndicesExtraKind:case e.MatricesWeightsKind:case e.MatricesWeightsExtraKind:case e.TangentKind:return 4;default:throw new Error("Invalid kind '"+t+"'")}}static GetDataType(t){return t instanceof Int8Array?e.BYTE:t instanceof Uint8Array?e.UNSIGNED_BYTE:t instanceof Int16Array?e.SHORT:t instanceof Uint16Array?e.UNSIGNED_SHORT:t instanceof Int32Array?e.INT:t instanceof Uint32Array?e.UNSIGNED_INT:e.FLOAT}static GetTypeByteLength(t){return g(t)}static ForEach(t,i,r,f,l,h,u,a){D(t,i,r,f,l,h,u,(n,_)=>{for(let o=0;o<f;o++)a(n[o],_+o)})}static GetFloatData(t,i,r,f,l,h,u,a){return T(t,i,r,f,l,h,u,a)}}return e._Counter=0,e.BYTE=5120,e.UNSIGNED_BYTE=5121,e.SHORT=5122,e.UNSIGNED_SHORT=5123,e.INT=5124,e.UNSIGNED_INT=5125,e.FLOAT=5126,e.PositionKind="position",e.NormalKind="normal",e.TangentKind="tangent",e.UVKind="uv",e.UV2Kind="uv2",e.UV3Kind="uv3",e.UV4Kind="uv4",e.UV5Kind="uv5",e.UV6Kind="uv6",e.ColorKind="color",e.ColorInstanceKind="instanceColor",e.MatricesIndicesKind="matricesIndices",e.MatricesWeightsKind="matricesWeights",e.MatricesIndicesExtraKind="matricesIndicesExtra",e.MatricesWeightsExtraKind="matricesWeightsExtra",e})();export{g as a,M as b,G as c,P as d,S as e,N as f};
