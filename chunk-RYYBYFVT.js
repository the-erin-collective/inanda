import{a as R}from"./chunk-BHFEZSPI.js";import{a as C,q as I}from"./chunk-6LMVZKMZ.js";import{a as D}from"./chunk-RTTN2363.js";import{h as p}from"./chunk-RMITEGV7.js";import{e as U,f as P}from"./chunk-C4D4KATR.js";import{b as m}from"./chunk-65CEQG3Z.js";import{a as M}from"./chunk-PTJ4CXVK.js";import{a as c}from"./chunk-L3UYHT7M.js";function ee(t){t.indexOf("vClipPlane")===-1&&t.push("vClipPlane"),t.indexOf("vClipPlane2")===-1&&t.push("vClipPlane2"),t.indexOf("vClipPlane3")===-1&&t.push("vClipPlane3"),t.indexOf("vClipPlane4")===-1&&t.push("vClipPlane4"),t.indexOf("vClipPlane5")===-1&&t.push("vClipPlane5"),t.indexOf("vClipPlane6")===-1&&t.push("vClipPlane6")}function te(t,e,r){let o=!!(t.clipPlane??e.clipPlane),a=!!(t.clipPlane2??e.clipPlane2),i=!!(t.clipPlane3??e.clipPlane3),n=!!(t.clipPlane4??e.clipPlane4),s=!!(t.clipPlane5??e.clipPlane5),u=!!(t.clipPlane6??e.clipPlane6);o&&r.push("#define CLIPPLANE"),a&&r.push("#define CLIPPLANE2"),i&&r.push("#define CLIPPLANE3"),n&&r.push("#define CLIPPLANE4"),s&&r.push("#define CLIPPLANE5"),u&&r.push("#define CLIPPLANE6")}function H(t,e,r){let o=!1,a=!!(t.clipPlane??e.clipPlane),i=!!(t.clipPlane2??e.clipPlane2),n=!!(t.clipPlane3??e.clipPlane3),s=!!(t.clipPlane4??e.clipPlane4),u=!!(t.clipPlane5??e.clipPlane5),l=!!(t.clipPlane6??e.clipPlane6);return r.CLIPPLANE!==a&&(r.CLIPPLANE=a,o=!0),r.CLIPPLANE2!==i&&(r.CLIPPLANE2=i,o=!0),r.CLIPPLANE3!==n&&(r.CLIPPLANE3=n,o=!0),r.CLIPPLANE4!==s&&(r.CLIPPLANE4=s,o=!0),r.CLIPPLANE5!==u&&(r.CLIPPLANE5=u,o=!0),r.CLIPPLANE6!==l&&(r.CLIPPLANE6=l,o=!0),o}function re(t,e,r){let o=e.clipPlane??r.clipPlane;N(t,"vClipPlane",o),o=e.clipPlane2??r.clipPlane2,N(t,"vClipPlane2",o),o=e.clipPlane3??r.clipPlane3,N(t,"vClipPlane3",o),o=e.clipPlane4??r.clipPlane4,N(t,"vClipPlane4",o),o=e.clipPlane5??r.clipPlane5,N(t,"vClipPlane5",o),o=e.clipPlane6??r.clipPlane6,N(t,"vClipPlane6",o)}function N(t,e,r){r&&t.setFloat4(e,r.normal.x,r.normal.y,r.normal.z,r.d)}var h=D.Black(),S={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function ue(t,e,r){if(!t||t.LOGARITHMICDEPTH||t.indexOf&&t.indexOf("LOGARITHMICDEPTH")>=0){let o=r.activeCamera;o.mode===1&&M.Error("Logarithmic depth is not compatible with orthographic cameras!",20),e.setFloat("logarithmicDepthConstant",2/(Math.log(o.maxZ+1)/Math.LN2))}}function Ee(t,e,r,o=!1){r&&t.fogEnabled&&(!e||e.applyFog)&&t.fogMode!==0&&(r.setFloat4("vFogInfos",t.fogMode,t.fogStart,t.fogEnd,t.fogDensity),o?(t.fogColor.toLinearSpaceToRef(h,t.getEngine().useExactSrgbConversions),r.setColor3("vFogColor",h)):r.setColor3("vFogColor",t.fogColor))}function F(t,e,r,o,a,i,n,s,u,l){let E=t.numMaxInfluencers||t.numInfluencers;return E<=0?0:(e.push("#define MORPHTARGETS"),t.hasPositions&&e.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),t.hasNormals&&e.push("#define MORPHTARGETTEXTURE_HASNORMALS"),t.hasTangents&&e.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),t.hasUVs&&e.push("#define MORPHTARGETTEXTURE_HASUVS"),t.hasUV2s&&e.push("#define MORPHTARGETTEXTURE_HASUV2S"),t.hasColors&&e.push("#define MORPHTARGETTEXTURE_HASCOLORS"),t.supportsPositions&&a&&e.push("#define MORPHTARGETS_POSITION"),t.supportsNormals&&i&&e.push("#define MORPHTARGETS_NORMAL"),t.supportsTangents&&n&&e.push("#define MORPHTARGETS_TANGENT"),t.supportsUVs&&s&&e.push("#define MORPHTARGETS_UV"),t.supportsUV2s&&u&&e.push("#define MORPHTARGETS_UV2"),t.supportsColors&&l&&e.push("#define MORPHTARGETS_COLOR"),e.push("#define NUM_MORPH_INFLUENCERS "+E),t.isUsingTextureForTargets&&e.push("#define MORPHTARGETS_TEXTURE"),S.NUM_MORPH_INFLUENCERS=E,S.NORMAL=i,S.TANGENT=n,S.UV=s,S.UV2=u,S.COLOR=l,d(r,o,S,a),E)}function d(t,e,r,o=!0){let a=r.NUM_MORPH_INFLUENCERS;if(a>0&&m.LastCreatedEngine){let i=m.LastCreatedEngine.getCaps().maxVertexAttribs,n=e.morphTargetManager;if(n?.isUsingTextureForTargets)return;let s=n&&n.supportsPositions&&o,u=n&&n.supportsNormals&&r.NORMAL,l=n&&n.supportsTangents&&r.TANGENT,E=n&&n.supportsUVs&&r.UV1,A=n&&n.supportsUV2s&&r.UV2,_=n&&n.supportsColors&&r.VERTEXCOLOR;for(let T=0;T<a;T++)s&&t.push("position"+T),u&&t.push("normal"+T),l&&t.push("tangent"+T),E&&t.push("uv_"+T),A&&t.push("uv2_"+T),_&&t.push("color"+T),t.length>i&&M.Error("Cannot add more vertex attributes for mesh "+e.name)}}function y(t,e=!1){t.push("world0"),t.push("world1"),t.push("world2"),t.push("world3"),e&&(t.push("previousWorld0"),t.push("previousWorld1"),t.push("previousWorld2"),t.push("previousWorld3"))}function g(t,e){let r=t.morphTargetManager;!t||!r||e.setFloatArray("morphTargetInfluences",r.influences)}function Ae(t,e){e.bindToEffect(t,"Scene")}function pe(t,e,r){e._needUVs=!0,e[r]=!0,t.optimizeUVAllocation&&t.getTextureMatrix().isIdentityAs3x2()?(e[r+"DIRECTUV"]=t.coordinatesIndex+1,e["MAINUV"+(t.coordinatesIndex+1)]=!0):e[r+"DIRECTUV"]=0}function Te(t,e,r){let o=t.getTextureMatrix();e.updateMatrix(r+"Matrix",o)}function V(t,e,r){r.BAKED_VERTEX_ANIMATION_TEXTURE&&r.INSTANCES&&t.push("bakedVertexAnimationSettingsInstanced")}function k(t,e){return e.set(t),e}function G(t,e,r){if(!(!e||!t)&&(t.computeBonesUsingShaders&&e._bonesComputationForcedToCPU&&(t.computeBonesUsingShaders=!1),t.useBones&&t.computeBonesUsingShaders&&t.skeleton)){let o=t.skeleton;if(o.isUsingTextureForMatrices&&e.getUniformIndex("boneTextureWidth")>-1){let a=o.getTransformMatrixTexture(t);e.setTexture("boneSampler",a),e.setFloat("boneTextureWidth",4*(o.bones.length+1))}else{let a=o.getTransformMatrices(t);a&&(e.setMatrices("mBones",a),r&&t.getScene().prePassRenderer&&t.getScene().prePassRenderer.getIndex(2)&&(r.previousBones[t.uniqueId]||(r.previousBones[t.uniqueId]=a.slice()),e.setMatrices("mPreviousBones",r.previousBones[t.uniqueId]),k(a,r.previousBones[t.uniqueId])))}}}function w(t,e,r,o,a,i=!0){t._bindLight(e,r,o,a,i)}function Pe(t,e,r,o,a=4){let i=Math.min(e.lightSources.length,a);for(let n=0;n<i;n++){let s=e.lightSources[n];w(s,n,t,r,typeof o=="boolean"?o:o.SPECULARTERM,e.receiveShadows)}}function Se(t,e,r,o){r.NUM_BONE_INFLUENCERS>0&&(o.addCPUSkinningFallback(0,e),t.push("matricesIndices"),t.push("matricesWeights"),r.NUM_BONE_INFLUENCERS>4&&(t.push("matricesIndicesExtra"),t.push("matricesWeightsExtra")))}function ce(t,e){(e.INSTANCES||e.THIN_INSTANCES)&&y(t,!!e.PREPASS_VELOCITY),e.INSTANCESCOLOR&&t.push("instanceColor")}function Re(t,e,r=4,o=0){let a=0;for(let i=0;i<r&&t["LIGHT"+i];i++)i>0&&(a=o+i,e.addFallback(a,"LIGHT"+i)),t.SHADOWS||(t["SHADOW"+i]&&e.addFallback(o,"SHADOW"+i),t["SHADOWPCF"+i]&&e.addFallback(o,"SHADOWPCF"+i),t["SHADOWPCSS"+i]&&e.addFallback(o,"SHADOWPCSS"+i),t["SHADOWPOISSON"+i]&&e.addFallback(o,"SHADOWPOISSON"+i),t["SHADOWESM"+i]&&e.addFallback(o,"SHADOWESM"+i),t["SHADOWCLOSEESM"+i]&&e.addFallback(o,"SHADOWCLOSEESM"+i));return a++}function z(t,e){return e.fogEnabled&&t.applyFog&&e.fogMode!==0}function Ne(t,e,r,o,a,i,n,s=!1){n._areMiscDirty&&(n.LOGARITHMICDEPTH=r,n.POINTSIZE=o,n.FOG=a&&z(t,e),n.NONUNIFORMSCALING=t.nonUniformScaling,n.ALPHATEST=i,n.DECAL_AFTER_DETAIL=s)}function Oe(t,e,r,o,a=4,i=!1){if(!r._areLightsDirty)return r._needNormals;let n=0,s={needNormals:r._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(t.lightsEnabled&&!i){for(let l of e.lightSources)if(Y(t,e,l,n,r,o,s),n++,n===a)break}r.SPECULARTERM=s.specularEnabled,r.SHADOWS=s.shadowEnabled;for(let l=n;l<a;l++)r["LIGHT"+l]!==void 0&&(r["LIGHT"+l]=!1,r["HEMILIGHT"+l]=!1,r["POINTLIGHT"+l]=!1,r["DIRLIGHT"+l]=!1,r["SPOTLIGHT"+l]=!1,r["AREALIGHT"+l]=!1,r["SHADOW"+l]=!1,r["SHADOWCSM"+l]=!1,r["SHADOWCSMDEBUG"+l]=!1,r["SHADOWCSMNUM_CASCADES"+l]=!1,r["SHADOWCSMUSESHADOWMAXZ"+l]=!1,r["SHADOWCSMNOBLEND"+l]=!1,r["SHADOWCSM_RIGHTHANDED"+l]=!1,r["SHADOWPCF"+l]=!1,r["SHADOWPCSS"+l]=!1,r["SHADOWPOISSON"+l]=!1,r["SHADOWESM"+l]=!1,r["SHADOWCLOSEESM"+l]=!1,r["SHADOWCUBE"+l]=!1,r["SHADOWLOWQUALITY"+l]=!1,r["SHADOWMEDIUMQUALITY"+l]=!1);let u=t.getEngine().getCaps();return r.SHADOWFLOAT===void 0&&(s.needRebuild=!0),r.SHADOWFLOAT=s.shadowEnabled&&(u.textureFloatRender&&u.textureFloatLinearFiltering||u.textureHalfFloatRender&&u.textureHalfFloatLinearFiltering),r.LIGHTMAPEXCLUDED=s.lightmapMode,s.needRebuild&&r.rebuild(),s.needNormals}function Y(t,e,r,o,a,i,n){switch(n.needNormals=!0,a["LIGHT"+o]===void 0&&(n.needRebuild=!0),a["LIGHT"+o]=!0,a["SPOTLIGHT"+o]=!1,a["HEMILIGHT"+o]=!1,a["POINTLIGHT"+o]=!1,a["DIRLIGHT"+o]=!1,a["AREALIGHT"+o]=!1,r.prepareLightSpecificDefines(a,o),a["LIGHT_FALLOFF_PHYSICAL"+o]=!1,a["LIGHT_FALLOFF_GLTF"+o]=!1,a["LIGHT_FALLOFF_STANDARD"+o]=!1,r.falloffType){case R.FALLOFF_GLTF:a["LIGHT_FALLOFF_GLTF"+o]=!0;break;case R.FALLOFF_PHYSICAL:a["LIGHT_FALLOFF_PHYSICAL"+o]=!0;break;case R.FALLOFF_STANDARD:a["LIGHT_FALLOFF_STANDARD"+o]=!0;break}if(i&&!r.specular.equalsFloats(0,0,0)&&(n.specularEnabled=!0),a["SHADOW"+o]=!1,a["SHADOWCSM"+o]=!1,a["SHADOWCSMDEBUG"+o]=!1,a["SHADOWCSMNUM_CASCADES"+o]=!1,a["SHADOWCSMUSESHADOWMAXZ"+o]=!1,a["SHADOWCSMNOBLEND"+o]=!1,a["SHADOWCSM_RIGHTHANDED"+o]=!1,a["SHADOWPCF"+o]=!1,a["SHADOWPCSS"+o]=!1,a["SHADOWPOISSON"+o]=!1,a["SHADOWESM"+o]=!1,a["SHADOWCLOSEESM"+o]=!1,a["SHADOWCUBE"+o]=!1,a["SHADOWLOWQUALITY"+o]=!1,a["SHADOWMEDIUMQUALITY"+o]=!1,e&&e.receiveShadows&&t.shadowsEnabled&&r.shadowEnabled){let s=r.getShadowGenerator(t.activeCamera)??r.getShadowGenerator();if(s){let u=s.getShadowMap();u&&u.renderList&&u.renderList.length>0&&(n.shadowEnabled=!0,s.prepareDefines(a,o))}}r.lightmapMode!=R.LIGHTMAP_DEFAULT?(n.lightmapMode=!0,a["LIGHTMAPEXCLUDED"+o]=!0,a["LIGHTMAPNOSPECULAR"+o]=r.lightmapMode==R.LIGHTMAP_SHADOWSONLY):(a["LIGHTMAPEXCLUDED"+o]=!1,a["LIGHTMAPNOSPECULAR"+o]=!1)}function _e(t,e,r,o,a,i=null,n=!1){let s=Z(t,o);i!==!1&&(s=H(r,t,o)),o.DEPTHPREPASS!==!e.getColorWrite()&&(o.DEPTHPREPASS=!o.DEPTHPREPASS,s=!0),o.INSTANCES!==a&&(o.INSTANCES=a,s=!0),o.THIN_INSTANCES!==n&&(o.THIN_INSTANCES=n,s=!0),s&&o.markAsUnprocessed()}function K(t,e){if(t.useBones&&t.computeBonesUsingShaders&&t.skeleton){e.NUM_BONE_INFLUENCERS=t.numBoneInfluencers;let r=e.BONETEXTURE!==void 0;if(t.skeleton.isUsingTextureForMatrices&&r)e.BONETEXTURE=!0;else{e.BonesPerMesh=t.skeleton.bones.length+1,e.BONETEXTURE=r?!1:void 0;let o=t.getScene().prePassRenderer;if(o&&o.enabled){let a=o.excludedSkinnedMesh.indexOf(t)===-1;e.BONES_VELOCITY_ENABLED=a}}}else e.NUM_BONE_INFLUENCERS=0,e.BonesPerMesh=0,e.BONETEXTURE!==void 0&&(e.BONETEXTURE=!1)}function q(t,e){let r=t.morphTargetManager;r?(e.MORPHTARGETS_UV=r.supportsUVs&&e.UV1,e.MORPHTARGETS_UV2=r.supportsUV2s&&e.UV2,e.MORPHTARGETS_TANGENT=r.supportsTangents&&e.TANGENT,e.MORPHTARGETS_NORMAL=r.supportsNormals&&e.NORMAL,e.MORPHTARGETS_POSITION=r.supportsPositions,e.MORPHTARGETS_COLOR=r.supportsColors,e.MORPHTARGETTEXTURE_HASUVS=r.hasUVs,e.MORPHTARGETTEXTURE_HASUV2S=r.hasUV2s,e.MORPHTARGETTEXTURE_HASTANGENTS=r.hasTangents,e.MORPHTARGETTEXTURE_HASNORMALS=r.hasNormals,e.MORPHTARGETTEXTURE_HASPOSITIONS=r.hasPositions,e.MORPHTARGETTEXTURE_HASCOLORS=r.hasColors,e.NUM_MORPH_INFLUENCERS=r.numMaxInfluencers||r.numInfluencers,e.MORPHTARGETS=e.NUM_MORPH_INFLUENCERS>0,e.MORPHTARGETS_TEXTURE=r.isUsingTextureForTargets):(e.MORPHTARGETS_UV=!1,e.MORPHTARGETS_UV2=!1,e.MORPHTARGETS_TANGENT=!1,e.MORPHTARGETS_NORMAL=!1,e.MORPHTARGETS_POSITION=!1,e.MORPHTARGETS_COLOR=!1,e.MORPHTARGETTEXTURE_HASUVS=!1,e.MORPHTARGETTEXTURE_HASUV2S=!1,e.MORPHTARGETTEXTURE_HASTANGENTS=!1,e.MORPHTARGETTEXTURE_HASNORMALS=!1,e.MORPHTARGETTEXTURE_HASPOSITIONS=!1,e.MORPHTARGETTEXTURE_HAS_COLORS=!1,e.MORPHTARGETS=!1,e.NUM_MORPH_INFLUENCERS=0)}function Q(t,e){let r=t.bakedVertexAnimationManager;e.BAKED_VERTEX_ANIMATION_TEXTURE=!!(r&&r.isEnabled)}function fe(t,e,r,o,a=!1,i=!0,n=!0){if(!e._areAttributesDirty&&e._needNormals===e._normals&&e._needUVs===e._uvs)return!1;e._normals=e._needNormals,e._uvs=e._needUVs,e.NORMAL=e._needNormals&&t.isVerticesDataPresent("normal"),e._needNormals&&t.isVerticesDataPresent("tangent")&&(e.TANGENT=!0);for(let s=1;s<=6;++s)e["UV"+s]=e._needUVs?t.isVerticesDataPresent(`uv${s===1?"":s}`):!1;if(r){let s=t.useVertexColors&&t.isVerticesDataPresent("color");e.VERTEXCOLOR=s,e.VERTEXALPHA=t.hasVertexAlpha&&s&&i}return t.isVerticesDataPresent("instanceColor")&&(t.hasInstances||t.hasThinInstances)&&(e.INSTANCESCOLOR=!0),o&&K(t,e),a&&q(t,e),n&&Q(t,e),!0}function Le(t,e){if(t.activeCamera){let r=e.MULTIVIEW;e.MULTIVIEW=t.activeCamera.outputRenderTarget!==null&&t.activeCamera.outputRenderTarget.getViewCount()>1,e.MULTIVIEW!=r&&e.markAsUnprocessed()}}function me(t,e,r){let o=e.ORDER_INDEPENDENT_TRANSPARENCY,a=e.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;e.ORDER_INDEPENDENT_TRANSPARENCY=t.useOrderIndependentTransparency&&r,e.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!t.getEngine().getCaps().textureFloatLinearFiltering,(o!==e.ORDER_INDEPENDENT_TRANSPARENCY||a!==e.ORDER_INDEPENDENT_TRANSPARENCY_16BITS)&&e.markAsUnprocessed()}function Me(t,e,r){let o=e.PREPASS;if(!e._arePrePassDirty)return;let a=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(t.prePassRenderer&&t.prePassRenderer.enabled&&r){e.PREPASS=!0,e.SCENE_MRT_COUNT=t.prePassRenderer.mrtCount,e.PREPASS_NORMAL_WORLDSPACE=t.prePassRenderer.generateNormalsInWorldSpace,e.PREPASS_COLOR=!0,e.PREPASS_COLOR_INDEX=0;for(let i=0;i<a.length;i++){let n=t.prePassRenderer.getIndex(a[i].type);n!==-1?(e[a[i].define]=!0,e[a[i].index]=n):e[a[i].define]=!1}}else{e.PREPASS=!1;for(let i=0;i<a.length;i++)e[a[i].define]=!1}e.PREPASS!=o&&(e.markAsUnprocessed(),e.markAsImageProcessingDirty())}function Z(t,e){let r=!1;if(t.activeCamera){let o=e.CAMERA_ORTHOGRAPHIC?1:0,a=e.CAMERA_PERSPECTIVE?1:0,i=t.activeCamera.mode===1?1:0,n=t.activeCamera.mode===0?1:0;(o^i||a^n)&&(e.CAMERA_ORTHOGRAPHIC=i===1,e.CAMERA_PERSPECTIVE=n===1,r=!0)}return r}function j(t,e,r,o,a=null,i=!1,n=!1){a&&a.push("Light"+t),!i&&(e.push("vLightData"+t,"vLightDiffuse"+t,"vLightSpecular"+t,"vLightDirection"+t,"vLightWidth"+t,"vLightHeight"+t,"vLightFalloff"+t,"vLightGround"+t,"lightMatrix"+t,"shadowsInfo"+t,"depthValues"+t),r.push("shadowTexture"+t),r.push("depthTexture"+t),e.push("viewFrustumZ"+t,"cascadeBlendFactor"+t,"lightSizeUVCorrection"+t,"depthCorrection"+t,"penumbraDarkness"+t,"frustumLengths"+t),o&&(r.push("projectionLightTexture"+t),e.push("textureProjectionMatrix"+t)),n&&r.push("iesLightTexture"+t))}function Ce(t,e,r,o=4){let a,i;if(t.uniformsNames){let n=t;a=n.uniformsNames,i=n.uniformBuffersNames,e=n.samplers,r=n.defines,o=n.maxSimultaneousLights||0}else a=t,e||(e=[]);for(let n=0;n<o&&r["LIGHT"+n];n++)j(n,a,e,r["PROJECTEDLIGHTTEXTURE"+n],i,!1,r["IESLIGHTTEXTURE"+n]);r.NUM_MORPH_INFLUENCERS&&(a.push("morphTargetInfluences"),a.push("morphTargetCount")),r.BAKED_VERTEX_ANIMATION_TEXTURE&&(a.push("bakedVertexAnimationSettings"),a.push("bakedVertexAnimationTextureSizeInverted"),a.push("bakedVertexAnimationTime"),e.push("bakedVertexAnimationTexture"))}var O=class{static extractMinAndMaxIndexed(e,r,o,a,i,n){for(let s=o;s<o+a;s++){let u=r[s]*3,l=e[u],E=e[u+1],A=e[u+2];i.minimizeInPlaceFromFloats(l,E,A),n.maximizeInPlaceFromFloats(l,E,A)}}static extractMinAndMax(e,r,o,a,i,n){for(let s=r,u=r*a;s<r+o;s++,u+=a){let l=e[u],E=e[u+1],A=e[u+2];i.minimizeInPlaceFromFloats(l,E,A),n.maximizeInPlaceFromFloats(l,E,A)}}};C([I.filter((...[t,e])=>!Array.isArray(t)&&!Array.isArray(e))],O,"extractMinAndMaxIndexed",null);C([I.filter((...[t])=>!Array.isArray(t))],O,"extractMinAndMax",null);function He(t,e,r,o,a=null){let i=new p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return O.extractMinAndMaxIndexed(t,e,r,o,i,n),a&&(i.x-=i.x*a.x+a.y,i.y-=i.y*a.x+a.y,i.z-=i.z*a.x+a.y,n.x+=n.x*a.x+a.y,n.y+=n.y*a.x+a.y,n.z+=n.z*a.x+a.y),{minimum:i,maximum:n}}function x(t,e,r,o=null,a){let i=new p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return a||(a=3),O.extractMinAndMax(t,e,r,a,i,n),o&&(i.x-=i.x*o.x+o.y,i.y-=i.y*o.x+o.y,i.z-=i.z*o.x+o.y,n.x+=n.x*o.x+o.y,n.y+=n.y*o.x+o.y,n.z+=n.z*o.x+o.y),{minimum:i,maximum:n}}function he(t,e){let r=x(t,0,t.length/3),o=r.maximum.subtract(r.minimum).scale(.5).add(r.minimum),a=new p,i=new p,n=new p,s=new p,u=new p,l=new p,E=new p;for(let A=0;A<e.length;A+=3){let _=e[A],T=e[A+1],f=e[A+2];a.fromArray(t,_*3),i.fromArray(t,T*3),n.fromArray(t,f*3),i.subtractToRef(a,s),n.subtractToRef(a,u),p.CrossToRef(s,u,l),l.normalize();let b=a.x+i.x+n.x,W=a.y+i.y+n.y,X=a.z+i.z+n.z;E.set(b/3,W/3,X/3),E.subtractInPlace(o),E.normalize(),p.Dot(l,E)>=0&&(e[A]=f,e[A+2]=_)}}var v="gpuTransformVertexShader",J=`attribute vec3 position;
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
out vec3 outPosition;const mat4 identity=mat4(
vec4(1.0,0.0,0.0,0.0),
vec4(0.0,1.0,0.0,0.0),
vec4(0.0,0.0,1.0,0.0),
vec4(0.0,0.0,0.0,1.0)
);void main(void) {vec3 positionUpdated=position;
#include<morphTargetsVertexGlobal>
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
mat4 finalWorld=identity;
#include<bonesVertex>
#include<bakedVertexAnimation>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);outPosition=worldPos.xyz;}`;c.ShadersStore[v]||(c.ShadersStore[v]=J);var B="gpuTransformPixelShader",$=`#version 300 es
void main() {discard;}
`;c.ShadersStore[B]||(c.ShadersStore[B]=$);var L=class t{constructor(e){this._buffers={},this._effects={},this._meshListCounter=0,this._engine=e}processAsync(e){return Array.isArray(e)||(e=[e]),this._meshListCounter=0,this._processMeshList(e),Promise.resolve()}_processMeshList(e){let r=this._engine.getCaps().parallelShaderCompile;this._engine.getCaps().parallelShaderCompile=void 0;for(let o=0;o<e.length;++o){let a=e[o];if(a.getTotalVertices()===0||!a.getVertexBuffer||!a.getVertexBuffer(P.PositionKind))continue;let n,s=[],u=[P.PositionKind];a&&a.useBones&&a.computeBonesUsingShaders&&a.skeleton?(u.push(P.MatricesIndicesKind),u.push(P.MatricesWeightsKind),a.numBoneInfluencers>4&&(u.push(P.MatricesIndicesExtraKind),u.push(P.MatricesWeightsExtraKind)),s.push("#define NUM_BONE_INFLUENCERS "+a.numBoneInfluencers),s.push("#define BONETEXTURE "+a.skeleton.isUsingTextureForMatrices),s.push("#define BonesPerMesh "+(a.skeleton.bones.length+1))):s.push("#define NUM_BONE_INFLUENCERS 0");let l=a.morphTargetManager?F(a.morphTargetManager,s,u,a,!0,!1,!1,!1,!1,!1):0,E=a.bakedVertexAnimationManager;E&&E.isEnabled&&(s.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),V(u,a,s));let A=s.join(`
`);if(this._effects[A])n=this._effects[A];else{let f={attributes:u,uniformsNames:["boneTextureWidth","mBones","morphTargetInfluences","morphTargetCount","morphTargetTextureInfo","morphTargetTextureIndices","bakedVertexAnimationSettings","bakedVertexAnimationTextureSizeInverted","bakedVertexAnimationTime"],uniformBuffersNames:[],samplers:["boneSampler","morphTargets","bakedVertexAnimationTexture"],defines:A,fallbacks:null,onCompiled:null,onError:null,indexParameters:{maxSimultaneousMorphTargets:l},maxSimultaneousLights:0,transformFeedbackVaryings:["outPosition"]};n=this._engine.createEffect("gpuTransform",f,this._engine),this._effects[A]=n}this._compute(a,n)}this._engine.getCaps().parallelShaderCompile=r}_compute(e,r){let o=this._engine,a,i=e.getTotalVertices();if(this._buffers[e.uniqueId])a=this._buffers[e.uniqueId];else{let u=new Float32Array(i*3);a=new U(e.getEngine(),u,!0,3),this._buffers[e.uniqueId]=a}r.getEngine().enableEffect(r),e._bindDirect(r,null,!0),G(e,r),g(e,r),e.morphTargetManager&&e.morphTargetManager.isUsingTextureForTargets&&e.morphTargetManager._bind(r);let n=e.bakedVertexAnimationManager;n&&n.isEnabled&&e.bakedVertexAnimationManager?.bind(r,!1);let s=a.getData();if(o.bindTransformFeedbackBuffer(a.getBuffer()),o.setRasterizerState(!1),o.beginTransformFeedback(!0),o.drawArraysType(2,0,i),o.endTransformFeedback(),o.setRasterizerState(!0),o.readTransformFeedbackBuffer(s),o.bindTransformFeedbackBuffer(null),this._meshListCounter===0)e._refreshBoundingInfo(s,null);else{let u=e.getBoundingInfo().boundingBox,l=x(s,0,i);t._Min.copyFrom(u.minimum).minimizeInPlace(l.minimum),t._Max.copyFrom(u.maximum).maximizeInPlace(l.maximum),e._refreshBoundingInfoDirect({minimum:t._Min,maximum:t._Max})}}registerMeshListAsync(e){return Array.isArray(e)||(e=[e]),this._meshList=e,this._meshListCounter=0,Promise.resolve()}processMeshList(){this._meshList.length!==0&&(this._processMeshList(this._meshList),this._meshListCounter++)}fetchResultsForMeshListAsync(){return this._meshListCounter=0,Promise.resolve()}dispose(){for(let e in this._buffers)this._buffers[e].dispose();this._buffers={},this._effects={},this._engine=null}};L._Min=new p;L._Max=new p;export{He as a,x as b,he as c,ee as d,te as e,re as f,ue as g,Ee as h,F as i,d as j,y as k,g as l,Ae as m,pe as n,Te as o,V as p,G as q,w as r,Pe as s,Se as t,ce as u,Re as v,z as w,Ne as x,Oe as y,Y as z,_e as A,K as B,q as C,fe as D,Le as E,me as F,Me as G,Z as H,j as I,Ce as J,L as K};
